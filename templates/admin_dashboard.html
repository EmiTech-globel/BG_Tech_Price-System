<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - BrainGain Tech</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/logo.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="body-container">
    <div class="container">
        <!-- Admin Header -->
        <div class="admin-header">
            <div class="admin-header-left">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="BrainGain Tech">
                <div>
                    <h1>Admin Dashboard</h1>
                    <div class="admin-subtitle">Manage Quotes, Inventory & Training Data</div>
                </div>
            </div>
            <div class="admin-header-right">
                <div class="admin-user-info">
                    <div style="font-weight: 600;">Admin</div>
                    <div class="admin-user-email">{{ user_email }}</div>
                </div>
                <button class="btn-logout" onclick="handleLogout()">Logout</button>
            </div>
        </div>
        
        <!-- Alert Box for notifications -->
        <div id="adminAlert" class="admin-alert"></div>
        
        <!-- Tabs Navigation -->
        <div class="tabs">
            <div class="tab active" onclick="showTab('overview')">
                Overview
            </div>
            <div class="tab" onclick="showTab('quotes')">
                Saved Quotes
            </div>
            <div class="tab" onclick="showTab('inventory')">
                Inventory
            </div>
            <div class="tab" onclick="showTab('reports')">
                Reports
            </div>
            <div class="tab" onclick="showTab('addjob')">
                Training Data
            </div>
            <div class="tab" onclick="showTab('settings')">
                Settings
            </div>
        </div>
        
        <div class="content">
            <div id="overview" class="tab-content active">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border-left: 5px solid #E89D3C;">
                        <div style="color: #999; font-size: 0.9em; margin-bottom: 5px;">Quoted Today</div>
                        <div style="font-size: 1.8em; font-weight: bold; color: #333;" id="stat_today_value">‚Ç¶0.00</div>
                        <div style="font-size: 0.8em; color: #4CAF50; margin-top: 5px;">Based on generated quotes</div>
                    </div>
                    
                    <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border-left: 5px solid #2196F3;">
                        <div style="color: #999; font-size: 0.9em; margin-bottom: 5px;">Orders (7 Days)</div>
                        <div style="font-size: 1.8em; font-weight: bold; color: #333;" id="stat_week_orders">0</div>
                        <div style="font-size: 0.8em; color: #2196F3; margin-top: 5px;">Quote volume</div>
                    </div>
                    
                    <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border-left: 5px solid #F44336;">
                        <div style="color: #999; font-size: 0.9em; margin-bottom: 5px;">Low Stock Items</div>
                        <div style="font-size: 1.8em; font-weight: bold; color: #333;" id="stat_low_stock">0</div>
                        <div style="font-size: 0.8em; color: #F44336; margin-top: 5px;">Items below 5 sheets</div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
                    <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
                        <h3 style="margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px;">Recent Activity</h3>
                        <div id="activityFeed">
                            <div class="loading"><div class="spinner"></div></div>
                        </div>
                    </div>

                    <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); height: fit-content;">
                        <h3 style="margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px;">Quick Actions</h3>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <button onclick="showTab('inventory'); toggleInventoryForm()" class="btn" style="text-align: left; background: #f8f9fa; color: #333; border: 1px solid #ddd;">
                                Add New Stock
                            </button>
                            <button onclick="showOffcutPanel()" class="btn" style="text-align: left; background: #f8f9fa; color: #333; border: 1px solid #ddd;">
                                Manage Offcuts
                            </button>
                            <button onclick="showTab('addjob')" class="btn" style="text-align: left; background: #f8f9fa; color: #333; border: 1px solid #ddd;">
                                Add Training Data
                            </button>
                            <button onclick="window.location.href='/'" class="btn" style="text-align: left; background: #f8f9fa; color: #333; border: 1px solid #ddd;">
                                Create New Quote
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- SAVED QUOTES TAB -->
            <div id="quotes" class="tab-content">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; gap: 10px; flex-wrap: wrap;">
                    <div class="form-group" style="flex: 1; min-width: 250px;">
                        <label>Search Quotes</label>
                        <input type="text" id="searchQuotes" placeholder="Search by customer name or quote number..." onkeyup="searchQuotes()">
                    </div>
                    <div class="form-group" style="flex: 1; min-width: 200px;">
                        <label>Filter by Status</label>
                        <select id="statusFilter" onchange="filterQuotesByStatus()" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
                            <option value="">All Statuses</option>
                            <option value="draft">Draft</option>
                            <option value="confirmed">Confirmed</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                </div>
                
                <div id="quotesLoading" class="loading">
                    <div class="spinner"></div>
                    <p style="margin-top: 15px;">Loading quotes...</p>
                </div>
                
                <div id="quotesContainer">
                    <p style="text-align: center; color: #999;">No quotes saved yet.</p>
                </div>
            </div>
    
            <!-- INVENTORY TAB -->
               <div id="inventory" class="tab-content content">
                   <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-direction: column; gap: 10px; ">
                       <h2 style="font-size: 30px;">Material Inventory</h2>
                       <button onclick="toggleInventoryForm()" class="btn" style="padding: 10px 20px; font-size: 0.9em;">
                           + Add Stock
                       </button>
                   </div>
               
            <div id="inventoryForm" style="display: none; background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #ddd;">
                <h3 style="margin-bottom: 15px;">Manage Stock</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Material Name *</label>
                        <select id="inv_material">
                            <option value="">Select material...</option>
                            <option value="Acrylic">Acrylic</option>
                            <option value="Plywood">Plywood</option>
                            <option value="MDF">MDF</option>
                            <option value="Aluminum">Aluminum</option>
                            <option value="ACP">ACP</option>
                            <option value="Wood">Wood</option>
                            <option value="Metal">Metal</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Color *</label>
                        <input type="text" id="inv_color" placeholder="e.g. Red, Clear, Black, Natural">
                        <small style="color: #666;">Required - helps match customer orders</small>
                    </div>
                    
                    <div class="form-group">
                        <label>Thickness (mm) *</label>
                        <input type="number" id="inv_thickness" step="0.1" placeholder="e.g. 3.0">
                    </div>
                    
                    <div class="form-group">
                        <label>Sheet Width (mm) *</label>
                        <input type="number" id="inv_width" placeholder="e.g. 1219.2">
                    </div>
                    
                    <div class="form-group">
                        <label>Sheet Height (mm) *</label>
                        <input type="number" id="inv_height" placeholder="e.g. 2438.4">
                    </div>
                    
                    <div class="form-group">
                        <label>Stock Change (+/-) *</label>
                        <input type="number" id="inv_quantity" placeholder="e.g. 10 (In) or -5 (Out)">
                    </div>
                    
                    <div class="form-group">
                        <label>Price per Full Sheet (‚Ç¶) *</label>
                        <input type="number" id="inv_price_sheet" placeholder="e.g. 15000">
                        <small style="color: #666;">Total cost for one full sheet</small>
                    </div>
                    
                    <div class="form-group">
                        <label>Price per Sq. Ft (‚Ç¶)</label>
                        <input type="number" id="inv_price" placeholder="e.g. 1800 (optional)">
                        <small style="color: #666;">Will auto-calculate if left blank</small>
                    </div>
                    
                    <div class="form-group">
                        <label>Note (Optional)</label>
                        <input type="text" id="inv_note" placeholder="e.g. New Shipment, Supplier ABC">
                    </div>
                </div>
                
                <div style="margin-top: 15px; text-align: right;">
                    <button onclick="toggleInventoryForm()" style="background: #ccc; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-right: 10px;">Cancel</button>
                    <button onclick="submitInventory()" class="btn" style="padding: 10px 20px;">Save Stock</button>
                </div>
            </div>
       
            <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow-x: auto;">
                <thead style="background: #f1f1f1; border-bottom: 2px solid #ddd;">
                    <tr>
                        <th style="padding: 12px; text-align: left;">Material</th>
                        <th style="padding: 12px; text-align: left;">Color</th>
                        <th style="padding: 12px; text-align: left;">Details</th>
                        <th style="padding: 12px; text-align: center;">Stock</th>
                        <th style="padding: 12px; text-align: right;">Price/Sheet</th>
                        <th style="padding: 12px; text-align: right;">Price/Sq.Ft</th>
                        <th style="padding: 12px; text-align: center;">History</th>
                        <th style="padding: 12px; text-align: center;">Action</th>
                    </tr>
                </thead>
                <tbody id="inventoryTableBody">
                    <!-- Populated by JavaScript -->
                </tbody>
            </table>
            
            <div id="historyModal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:white; padding:20px; box-shadow:0 0 20px rgba(0,0,0,0.2); z-index:1000; width: 400px; border-radius: 8px;">
                <h3>Stock History</h3>
                <ul id="historyList" style="max-height: 300px; overflow-y: auto; padding-left: 0; list-style: none;"></ul>
                <button onclick="document.getElementById('historyModal').style.display='none'" class="btn">Close</button>
             </div>
           </div>
            
           <!-- OFFCUT MANAGEMENT MODAL -->
            <div id="offcutPanel" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1001; overflow-y: auto;">
                <div style="background: white; margin: 20px auto; padding: 30px; border-radius: 10px; width: 90%; max-width: 900px; box-shadow: 0 0 30px rgba(0,0,0,0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="margin: 0; color: #333;">Offcut Management</h2>
                        <button onclick="closeOffcutPanel()" style="background: #ccc; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 1.2em;">&times;</button>
                    </div>
                    <p style="color: #666; margin-bottom: 20px;">Available offcuts from previous jobs. These can be reused for new orders to reduce material waste.</p>
                    <div id="offcutsList" style="display: grid; gap: 15px; max-height: 400px; overflow-y: auto;">
                        <div style="text-align: center; color: #999;">
                            <div class="spinner" style="margin: 20px auto;"></div>
                            Loading offcuts...
                        </div>
                    </div>
                </div>
            </div>

            <!-- MATERIAL DEDUCTION CONFIRMATION MODAL -->
            <div id="confirmMaterialModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
                <div style="background: white; padding: 30px; border-radius: 10px; width: 90%; max-width: 600px; box-shadow: 0 0 30px rgba(0,0,0,0.3);">
                    <h2 style="margin-top: 0; color: #333;">Material Deduction Breakdown</h2>
                    <p style="color: #666; margin-bottom: 20px;">This order will deduct the following materials from inventory:</p>
                    <div id="materialBreakdown" style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; max-height: 300px; overflow-y: auto;">
                        <!-- Populated by JS -->
                    </div>
                    <div style="background: #FFF8F0; padding: 15px; border-left: 4px solid #E89D3C; margin-bottom: 20px; border-radius: 5px;">
                        <strong>Tip:</strong> If exact offcuts are not available, full sheets will be deducted and unused portions saved as new offcuts.
                    </div>
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button onclick="closeMaterialModal()" style="background: #ccc; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Cancel</button>
                        <button id="confirmDeductBtn" onclick="confirmQuoteOrder()" class="btn" style="padding: 10px 20px;">Confirm & Deduct</button>
                    </div>
                </div>
            </div>

           <!-- REPORT TAB -->
           <div id="reports" class="tab-content">
                <h2 style="margin-bottom: 20px;">Generate Business Reports</h2>
                
                <div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); width: 100%;">
                    <div class="form-group">
                        <label>Report Type</label>
                        <select id="reportType" class="form-control" style="width: 100%; padding: 10px; margin-bottom: 15px;">
                            <option value="revenue">üí∞ Revenue Report (Quotes & Income)</option>
                            <option value="material_usage">üìâ Material Usage (Stock Out)</option>
                            <option value="inventory_health">üè• Inventory Health (Stock Levels)</option>
                        </select>
                    </div>

                    <div class="row" style="display: flex; gap: 20px; margin-bottom: 20px;">
                        <div class="form-group" style="flex: 1;">
                            <label>Start Date</label>
                            <input type="date" id="reportStartDate" style="width: 100%; padding: 10px;">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>End Date</label>
                            <input type="date" id="reportEndDate" style="width: 100%; padding: 10px;">
                        </div>
                    </div>

                    <div style="background: #FFF8F0; padding: 15px; border-left: 4px solid #E89D3C; margin-bottom: 20px; font-size: 0.9em; color: #666;">
                        <p id="reportDesc">Generates a detailed PDF listing all approved quotes and total revenue for the selected period.</p>
                    </div>

                    <button type="button" onclick="event.preventDefault(); downloadReport()" class="btn" style="width: 100%; justify-content: center; font-size: 1.1em;">
                        üì• Download PDF Report
                    </button>
                </div>
            </div>

            <!-- ADD JOB TAB -->
                <div id="addjob" class="tab-content">
                    <div class="info-box">
                        <strong>üìä Training Data:</strong> Add completed jobs here to improve pricing accuracy. The more jobs you add, the better the predictions!
                    </div>
                    
                    <div style="background: #FFF8F0; padding: 20px; border-radius: 10px; margin-bottom: 20px; text-align: center;">
                        <div style="font-size: 2em; font-weight: bold; color: #E89D3C;" id="jobCount">50</div>
                        <div style="color: #9B9B9B; margin-top: 5px;">Total Training Jobs</div>
                        <div style="margin-top: 10px;">
                            <span style="color: #666;">Model Accuracy (R¬≤): </span>
                            <strong id="modelAccuracy">0.685</strong>
                        </div>
                    </div>
                    
                    <h3 style="margin-bottom: 20px;">Add Completed Job</h3>
                    
                    <div class="row">
                        <div class="form-group">
                            <label>Material *</label>
                            <select id="jobMaterial">
                                <option value="">Select material...</option>
                                <option value="Acrylic">Acrylic</option>
                                <option value="Wood">Wood</option>
                                <option value="Metal">Metal</option>
                                <option value="MDF">MDF</option>
                                <option value="Plywood">Plywood</option>
                                <option value="Foam">Foam</option>
                                <option value="Cardboard">Cardboard</option>
                                <option value="ACP">ACP</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Thickness (mm) *</label>
                            <input type="number" id="jobThickness" placeholder="e.g., 6" step="0.1">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="form-group">
                            <label>Width (mm) *</label>
                            <input type="number" id="jobWidth" placeholder="e.g., 500">
                        </div>
                        
                        <div class="form-group">
                            <label>Height (mm) *</label>
                            <input type="number" id="jobHeight" placeholder="e.g., 300">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="form-group">
                            <label>Number of Letters</label>
                            <input type="number" id="jobLetters" value="0" min="0">
                        </div>
                        
                        <div class="form-group">
                            <label>Number of Shapes</label>
                            <input type="number" id="jobShapes" value="1" min="1">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="form-group">
                            <label>Complexity (1-5)</label>
                            <select id="jobComplexity">
                                <option value="1">1 - Very Simple</option>
                                <option value="2">2 - Simple</option>
                                <option value="3" selected>3 - Moderate</option>
                                <option value="4">4 - Complex</option>
                                <option value="5">5 - Very Complex</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Cutting Time (minutes) *</label>
                            <input type="number" id="jobTime" placeholder="e.g., 30" step="0.1">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="form-group">
                            <label>Cutting Type *</label>
                            <select id="jobCuttingType">
                                <option value="Laser Cutting">Laser Cutting</option>
                                <option value="CNC Router">CNC Router</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Quantity</label>
                            <input type="number" id="jobQuantity" value="1" min="1">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Final Price Charged (‚Ç¶) *</label>
                        <input type="number" id="jobPrice" placeholder="e.g., 15000" step="0.01">
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="jobDetails">
                        <label for="jobDetails" style="margin: 0;">Has intricate details</label>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="jobRush">
                        <label for="jobRush" style="margin: 0;">‚ö° Was a rush job</label>
                    </div>
                    
                    <button class="btn" onclick="addTrainingJob()">‚ûï Add Job to Training Data</button>
                    
                    <div style="margin-top: 30px; padding-top: 30px; border-top: 2px solid #e0e0e0;">
                        <h3 style="margin-bottom: 15px;">üîÑ Retrain Model</h3>
                        <p style="color: #666; margin-bottom: 15px;">After adding several new jobs, retrain the model to improve accuracy.</p>
                        <button class="btn" onclick="retrainModel()" style="background: linear-gradient(135deg, #9B9B9B 0%, #7A7A7A 100%);">
                            üîÑ Retrain Model Now
                        </button>
                        <div id="retrainStatus" style="margin-top: 15px; text-align: center;"></div>
                    </div>
                </div>

                <!-- SETTINGS TAB -->
                <div id="settings" class="tab-content">
                    <h2 style="margin-bottom: 20px;">System Settings</h2>
                    
                    <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); width: 100%;">
                        <h3>üìß Automated Email Reports</h3>
                        <p style="color: #666; font-size: 0.9em; margin-bottom: 20px;"> Configure where the daily 6:30 PM PDF report is sent.</p>
                        
                        <div class="form-group" style="margin-bottom: 15px;">
                            <label>Recipient Email</label>
                            <input type="email" id="setting_email" class="form-control" placeholder="admin@braingaintech.com" style="width: 100%; padding: 10px;">
                        </div>
                
                        <div class="form-group" style="margin-bottom: 20px;">
                            <label>Report Time (Daily)</label>
                            <input type="time" id="setting_time" value="18:30" class="form-control" style="width: 100%; padding: 10px;">
                        </div>
                
                        <div style="display: flex; gap: 10px;">
                            <button onclick="saveSettings()" class="btn" style="flex: 2; justify-content: center;">üíæ Save Settings</button>
                            <button onclick="testEmail()" class="btn" style="flex: 1; background: #f8f9fa; color: #333; border: 1px solid #ddd; justify-content: center;">üìß Test Send</button>
                        </div>
                    </div>
                </div>             
        </div>
    </div>
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script src="{{ url_for('static', filename='js/admin.js') }}"></script>
    <script src="{{ url_for('static', filename='js/quote-status.js') }}"></script>
    <style>
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin-left: 10px;
        }
        .status-draft { background: #e3f2fd; color: #1976d2; }
        .status-confirmed { background: #c8e6c9; color: #388e3c; }
        .status-completed { background: #fff9c4; color: #f57f17; }
        .status-cancelled { background: #ffcdd2; color: #c62828; }
        .offcut-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .offcut-card:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-color: #E89D3C;
        }
        .action-button {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
        }
        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
    </style>
</body>
</html>